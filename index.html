<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Snail Cafe - Flumgus Edition</title>
<style>
  body, html {
    margin: 0; padding: 0; overflow: hidden;
    background: linear-gradient(135deg, #2E8B57 0%, #98FB98 100%);
    font-family: monospace;
    user-select: none;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  #gameContainer {
    flex: 1;
    position: relative;
    background: linear-gradient(to bottom, #F0FFF0 0%, #E6FFE6 100%);
    border: 3px solid #228B22;
    margin: 10px;
    border-radius: 8px;
    overflow: hidden;
  }
  
  #cafe {
    width: 100%;
    height: 100%;
    position: relative;
    background: repeating-linear-gradient(
      45deg,
      #F0FFF0,
      #F0FFF0 25px,
      #E6FFE6 25px,
      #E6FFE6 50px
    );
  }
  
  .customer-snail {
    position: absolute;
    width: 70px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    cursor: pointer;
    transition: all 0.3s;
    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
  }
  
  .customer-snail:hover {
    transform: scale(1.1);
    filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.4));
  }
  
  .customer-snail.waiting {
    animation: wiggle 2s infinite;
  }
  
  .customer-snail.angry {
    animation: angry-shake 0.8s infinite;
    filter: hue-rotate(0deg) saturate(150%) brightness(1.2);
  }
  
  @keyframes wiggle {
    0%, 100% { transform: rotate(0deg); }
    25% { transform: rotate(-3deg); }
    75% { transform: rotate(3deg); }
  }
  
  @keyframes angry-shake {
    0%, 100% { transform: translateX(0) scale(1); }
    25% { transform: translateX(-3px) scale(1.05); }
    75% { transform: translateX(3px) scale(1.05); }
  }
  
  .speech-bubble {
    position: absolute;
    top: -60px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.95);
    padding: 8px 12px;
    border-radius: 20px;
    border: 2px solid #228B22;
    font-size: 16px;
    font-weight: bold;
    white-space: nowrap;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    backdrop-filter: blur(5px);
  }
  
  .speech-bubble::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 10px solid transparent;
    border-top-color: rgba(255, 255, 255, 0.95);
  }
  
  .patience-bar {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 6px;
    background: #333;
    border-radius: 3px;
    overflow: hidden;
  }
  
  .patience-fill {
    height: 100%;
    background: linear-gradient(to right, #FF4444, #FFAA44, #44FF44);
    transition: width 0.5s ease;
  }
  
  #chef-snail {
    position: absolute;
    bottom: 130px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 48px;
    z-index: 10;
    animation: chef-bob 3s ease-in-out infinite;
  }
  
  @keyframes chef-bob {
    0%, 100% { transform: translateX(-50%) translateY(0px); }
    50% { transform: translateX(-50%) translateY(-5px); }
  }
  
  #kitchen-counter {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    height: 100px;
    background: linear-gradient(to bottom, #8B4513, #A0522D);
    border: 3px solid #654321;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: space-around;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.4);
  }
  
  .ingredient {
    background: linear-gradient(135deg, #FFE4B5, #DEB887);
    border: 2px solid #CD853F;
    border-radius: 12px;
    padding: 12px 8px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s;
    min-width: 70px;
    text-align: center;
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    position: relative;
  }
  
  .ingredient:hover {
    background: linear-gradient(135deg, #F0E68C, #DAA520);
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
  }
  
  .ingredient:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  
  .ingredient.cooking {
    animation: cook-glow 1s ease-in-out infinite alternate;
  }
  
  @keyframes cook-glow {
    from { box-shadow: 0 3px 6px rgba(0,0,0,0.2); }
    to { box-shadow: 0 3px 6px rgba(255,165,0,0.6), 0 0 20px rgba(255,165,0,0.3); }
  }
  
  #cooking-area {
    position: absolute;
    top: 20px;
    left: 20px;
    width: 200px;
    min-height: 100px;
    background: rgba(139, 69, 19, 0.8);
    border: 3px solid #8B4513;
    border-radius: 10px;
    padding: 10px;
    backdrop-filter: blur(5px);
  }
  
  .cooking-item {
    background: #FFE4B5;
    margin: 5px;
    padding: 8px;
    border-radius: 8px;
    border: 2px solid #CD853F;
    font-size: 14px;
    text-align: center;
    position: relative;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .cooking-item:hover {
    background: #F0E68C;
    transform: scale(1.05);
  }
  
  .cooking-item.ready {
    background: #90EE90;
    border-color: #32CD32;
    animation: ready-pulse 1s ease-in-out infinite alternate;
  }
  
  @keyframes ready-pulse {
    from { box-shadow: 0 0 5px rgba(50,205,50,0.5); }
    to { box-shadow: 0 0 15px rgba(50,205,50,0.8); }
  }
  
  .cook-timer {
    position: absolute;
    bottom: -2px;
    left: 0;
    height: 4px;
    background: #4CAF50;
    transition: width 0.1s linear;
    border-radius: 0 0 6px 6px;
  }
  
  #ui {
    background: linear-gradient(to right, #2F4F2F, #556B2F);
    padding: 12px;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 3px solid #228B22;
    flex-wrap: wrap;
    gap: 10px;
  }
  
  #stats {
    font-weight: bold;
    font-size: 16px;
  }
  
  #upgrades {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  
  .upgrade-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-family: monospace;
    font-size: 12px;
    transition: all 0.3s;
    min-width: 130px;
  }
  
  .upgrade-btn:hover {
    background: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  }
  
  .upgrade-btn:disabled {
    background: #666;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
  
  #happiness-meter {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 220px;
    height: 35px;
    background: #333;
    border: 3px solid #228B22;
    border-radius: 18px;
    overflow: hidden;
  }
  
  #happinessBar {
    height: 100%;
    background: linear-gradient(to right, #FF6B6B, #FFE66D, #4ECDC4, #45B7D1);
    width: 50%;
    transition: width 0.5s ease;
  }
  
  #happinessText {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 14px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  
  .game-over {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.95);
    color: white;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    font-size: 24px;
    z-index: 1000;
    border: 3px solid #228B22;
  }
  
  .restart-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 10px;
    cursor: pointer;
    font-family: monospace;
    font-size: 18px;
    margin-top: 20px;
    transition: all 0.3s;
  }
  
  .restart-btn:hover {
    background: #45a049;
    transform: scale(1.05);
  }
</style>
</head>
<body>

<div id="gameContainer">
  <div id="cafe">
    <div id="happiness-meter">
      <div id="happinessBar"></div>
      <div id="happinessText">üêå HAPPINESS: 50%</div>
    </div>
    
    <div id="cooking-area">
      <h3 style="margin: 0 0 10px 0; color: white; text-align: center;">üç≥ Kitchen</h3>
      <div id="cooking-queue"></div>
    </div>
    
    <div id="chef-snail">üêåüë®‚Äçüç≥</div>
    
    <div id="kitchen-counter">
      <div class="ingredient" data-ingredient="lettuce">ü•¨<br>Lettuce<br>2s</div>
      <div class="ingredient" data-ingredient="tomato">üçÖ<br>Tomato<br>3s</div>
      <div class="ingredient" data-ingredient="bread">üçû<br>Bread<br>4s</div>
      <div class="ingredient" data-ingredient="coffee">‚òï<br>Coffee<br>5s</div>
      <div class="ingredient" data-ingredient="cake">üßÅ<br>Cake<br>6s</div>
    </div>
  </div>
</div>

<div id="ui">
  <div id="stats">
    ü•¨ Lettuce Coins: <span id="money">0</span> | 
    üòä Happiness: <span id="happiness">50</span>% | 
    üçΩÔ∏è Served: <span id="served">0</span> | 
    Day: <span id="day">1</span>
  </div>
  <div id="upgrades">
    <button class="upgrade-btn" id="speedUpgrade">Faster Cooking (50ü•¨)</button>
    <button class="upgrade-btn" id="patienceUpgrade">Snail Patience (75ü•¨)</button>
    <button class="upgrade-btn" id="rewardUpgrade">Better Tips (100ü•¨)</button>
  </div>
</div>

<script>
(() => {
  const g = {
    money: 20,
    happiness: 50,
    served: 0,
    day: 1,
    customers: [],
    cookingItems: [],
    nextCustomerId: 0,
    nextCookingId: 0,
    cookingSpeedMult: 1,
    patienceMult: 1.5,
    rewardMult: 1,
    gameOver: false,
    lastCustomerSpawn: 0,
    customerSpawnRate: 4000,
    speedUpgradeCost: 50,
    patienceUpgradeCost: 75,
    rewardUpgradeCost: 100
  };
  
  const MAX_COOKING_ITEMS = 2;
  
  const cafe = document.getElementById('cafe');
  const cookingQueue = document.getElementById('cooking-queue');
  const els = {
    money: document.getElementById('money'),
    happiness: document.getElementById('happiness'),
    served: document.getElementById('served'),
    day: document.getElementById('day'),
    happinessBar: document.getElementById('happinessBar'),
    happinessText: document.getElementById('happinessText'),
    speedUpgrade: document.getElementById('speedUpgrade'),
    patienceUpgrade: document.getElementById('patienceUpgrade'),
    rewardUpgrade: document.getElementById('rewardUpgrade')
  };
  
  const recipes = {
    lettuce: { t: 2000, p: 3, e: 'ü•¨', n: 'Fresh Lettuce' },
    tomato: { t: 3000, p: 4, e: 'üçÖ', n: 'Juicy Tomato' },
    bread: { t: 4000, p: 5, e: 'üçû', n: 'Fresh Bread' },
    coffee: { t: 5000, p: 6, e: '‚òï', n: 'Snail Coffee' },
    cake: { t: 6000, p: 10, e: 'üßÅ', n: 'Snail Cake' }
  };
  
  const snailEmojis = ['üêå'];
  const snailColors = ['hue-rotate(0deg)', 'hue-rotate(60deg)', 'hue-rotate(120deg)', 'hue-rotate(180deg)', 'hue-rotate(240deg)', 'hue-rotate(300deg)'];
  
  function getRandomRecipe() {
    const keys = Object.keys(recipes);
    const weights = g.day === 1 ? [3, 3, 2, 1, 1] : [2, 2, 2, 2, 2];
    const totalWeight = weights.reduce((a, b) => a + b, 0);
    let r = Math.random() * totalWeight;
    
    for (let i = 0; i < keys.length; i++) {
      r -= weights[i];
      if (r <= 0) return keys[i];
    }
    return keys[0];
  }
  
  function spawnCustomer() {
    if (g.gameOver) return;
    
    const c = {
      id: g.nextCustomerId++,
      x: Math.random() * (cafe.offsetWidth - 100) + 20,
      y: Math.random() * (cafe.offsetHeight - 250) + 60,
      emoji: snailEmojis[0],
      color: snailColors[Math.floor(Math.random() * snailColors.length)],
      order: getRandomRecipe(),
      patience: 0,
      maxPatience: 100 * g.patienceMult,
      element: null,
      served: false,
      hasFood: false
    };
    
    c.patience = c.maxPatience;
    
    const el = document.createElement('div');
    el.className = 'customer-snail waiting';
    el.style.left = c.x + 'px';
    el.style.top = c.y + 'px';
    el.style.filter = c.color;
    el.innerHTML = c.emoji;
    el.onclick = () => serveCustomer(c.id);
    
    const bubble = document.createElement('div');
    bubble.className = 'speech-bubble';
    bubble.innerHTML = recipes[c.order].e + ' ' + recipes[c.order].n;
    el.appendChild(bubble);
    
    const pBar = document.createElement('div');
    pBar.className = 'patience-bar';
    const pFill = document.createElement('div');
    pFill.className = 'patience-fill';
    pFill.style.width = '100%';
    pBar.appendChild(pFill);
    el.appendChild(pBar);
    
    c.element = el;
    c.patienceFill = pFill;
    cafe.appendChild(el);
    g.customers.push(c);
  }
  
  function startCooking(ingredient) {
    if (g.cookingItems.length >= MAX_COOKING_ITEMS) return;
    
    const item = {
      id: g.nextCookingId++,
      ingredient: ingredient,
      startTime: Date.now(),
      cookTime: 2000 / g.cookingSpeedMult,
      ready: false,
      element: null
    };
    
    const el = document.createElement('div');
    el.className = 'cooking-item';
    el.innerHTML = `<div>${recipes[ingredient].e} ${ingredient}</div><div class="cook-timer"></div>`;
    el.onclick = () => {
      if (item.ready) completeCooking(item.id);
    };
    
    item.element = el;
    cookingQueue.appendChild(el);
    g.cookingItems.push(item);
    el.classList.add('cooking');
  }
  
  function completeCooking(cookingId) {
    const idx = g.cookingItems.findIndex(c => c.id === cookingId);
    if (idx === -1) return;
    
    const item = g.cookingItems[idx];
    if (!item.ready) return;
    
    const customer = g.customers.find(c => !c.served && !c.hasFood && c.order === item.ingredient);
    
    if (customer) {
      customer.hasFood = true;
      customer.element.classList.remove('waiting');
      customer.element.style.background = 'rgba(144, 238, 144, 0.3)';
      customer.element.style.borderRadius = '50%';
      
      const bubble = customer.element.querySelector('.speech-bubble');
      bubble.innerHTML = '‚úÖ Ready to serve!';
      bubble.style.background = 'rgba(144, 238, 144, 0.95)';
    }
    
    item.element.remove();
    g.cookingItems.splice(idx, 1);
  }
  
  function serveCustomer(customerId) {
    const idx = g.customers.findIndex(c => c.id === customerId);
    if (idx === -1) return;
    
    const c = g.customers[idx];
    if (c.served || !c.hasFood) return;
    
    c.served = true;
    
    const earnings = Math.floor(recipes[c.order].p * g.rewardMult);
    g.money += earnings;
    g.served++;
    g.happiness = Math.min(100, g.happiness + 3);
    
    c.element.style.background = 'rgba(144, 238, 144, 0.6)';
    c.element.style.transform = 'scale(1.3)';
    c.element.innerHTML = 'üêåüíö';
    
    setTimeout(() => {
      if (c.element && c.element.parentNode) {
        c.element.parentNode.removeChild(c.element);
      }
      g.customers.splice(idx, 1);
    }, 800);
    
    updateUI();
  }
  
  function updateCustomers() {
    g.customers.forEach(c => {
      if (c.served) return;
      
      c.patience -= 0.15;
      
      const pp = c.patience / c.maxPatience;
      c.patienceFill.style.width = (pp * 100) + '%';
      
      if (c.patience <= 0) {
        g.happiness = Math.max(0, g.happiness - 8);
        c.element.classList.add('angry');
        c.element.innerHTML = 'üêåüíî';
        
        setTimeout(() => {
          if (c.element && c.element.parentNode) {
            c.element.parentNode.removeChild(c.element);
          }
          const idx = g.customers.findIndex(cu => cu.id === c.id);
          if (idx !== -1) g.customers.splice(idx, 1);
        }, 1200);
      } else if (pp < 0.3) {
        c.element.classList.add('angry');
      }
    });
  }
  
  function updateCooking() {
    const now = Date.now();
    g.cookingItems.forEach(item => {
      if (item.ready) return;
      
      const elapsed = now - item.startTime;
      const progress = elapsed / item.cookTime;
      
      const timer = item.element.querySelector('.cook-timer');
      timer.style.width = Math.min(progress * 100, 100) + '%';
      
      if (elapsed >= item.cookTime) {
        item.ready = true;
        item.element.classList.remove('cooking');
        item.element.classList.add('ready');
        timer.style.width = '100%';
        timer.style.background = '#32CD32';
      }
    });
  }
  
  function updateUI() {
    els.money.textContent = g.money;
    els.happiness.textContent = Math.floor(g.happiness);
    els.served.textContent = g.served;
    els.day.textContent = g.day;
    
    els.happinessBar.style.width = g.happiness + '%';
    els.happinessText.textContent = `üêå HAPPINESS: ${Math.floor(g.happiness)}%`;
    
    els.speedUpgrade.disabled = g.money < g.speedUpgradeCost;
    els.patienceUpgrade.disabled = g.money < g.patienceUpgradeCost;
    els.rewardUpgrade.disabled = g.money < g.rewardUpgradeCost;
    
    els.speedUpgrade.textContent = `Faster Cooking (${g.speedUpgradeCost}ü•¨)`;
    els.patienceUpgrade.textContent = `Snail Patience (${g.patienceUpgradeCost}ü•¨)`;
    els.rewardUpgrade.textContent = `Better Tips (${g.rewardUpgradeCost}ü•¨)`;
  }
  
  function showGameOver() {
    const div = document.createElement('div');
    div.className = 'game-over';
    div.innerHTML = `
      <h2>üêå The Snail Cafe Closed! üêå</h2>
      <p>You served ${g.served} happy snails</p>
      <p>Earned ${g.money} Lettuce Coins in ${g.day} days</p>
      <p>Final Happiness: ${Math.floor(g.happiness)}%</p>
      <button class="restart-btn" onclick="location.reload()">Open New Cafe</button>
    `;
    document.body.appendChild(div);
  }
  
  function gameLoop() {
    if (g.gameOver) return;
    
    const now = Date.now();
    
    if (now - g.lastCustomerSpawn > g.customerSpawnRate) {
      spawnCustomer();
      g.lastCustomerSpawn = now;
    }
    
    updateCustomers();
    updateCooking();
    
    if (Math.random() < 0.002) {
      g.happiness = Math.max(0, g.happiness - 0.5);
    }
    
    if (g.served > 0 && g.served % 15 === 0) {
      g.customerSpawnRate = Math.max(2000, g.customerSpawnRate - 150);
      g.day = Math.floor(g.served / 15) + 1;
    }
    
    updateUI();
    
    if (g.happiness <= 0) {
      g.gameOver = true;
      showGameOver();
      return;
    }
    
    requestAnimationFrame(gameLoop);
  }
  
  document.querySelectorAll('.ingredient').forEach(ingredient => {
    ingredient.onclick = () => {
      const type = ingredient.dataset.ingredient;
      if (g.cookingItems.length < MAX_COOKING_ITEMS) {
        startCooking(type);
        ingredient.classList.add('cooking');
        setTimeout(() => ingredient.classList.remove('cooking'), 300);
      }
    };
  });
  
  els.speedUpgrade.onclick = () => {
    if (g.money >= g.speedUpgradeCost) {
      g.money -= g.speedUpgradeCost;
      g.cookingSpeedMult += 0.3;
      g.speedUpgradeCost = Math.floor(g.speedUpgradeCost * 1.4);
      updateUI();
    }
  };
  
  els.patienceUpgrade.onclick = () => {
    if (g.money >= g.patienceUpgradeCost) {
      g.money -= g.patienceUpgradeCost;
      g.patienceMult += 0.4;
      g.patienceUpgradeCost = Math.floor(g.patienceUpgradeCost * 1.4);
      updateUI();
    }
  };
  
  els.rewardUpgrade.onclick = () => {
    if (g.money >= g.rewardUpgradeCost) {
      g.money -= g.rewardUpgradeCost;
      g.rewardMult += 0.25;
      g.rewardUpgradeCost = Math.floor(g.rewardUpgradeCost * 1.4);
      updateUI();
    }
  };
  
  updateUI();
  gameLoop();
  
  setTimeout(() => {
    spawnCustomer();
    g.lastCustomerSpawn = Date.now();
  }, 3000);
  
})();
</script>

</body>
</html>
